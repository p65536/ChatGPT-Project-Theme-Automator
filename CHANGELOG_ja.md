# Changelog

## [1.2.3] - 2025-07-03

### 修正
* **スクロール領域縮小バグの修正**: Chrome系でメッセージ移動ボタン使用時に発生していたスクロール領域の縮小問題を、`scrollIntoView()`から`scrollTop`直接制御に変更することで解消しました。

### 改善
* **DOM監視の最適化**: 個別の`MutationObserver`を廃止し、全ターンを単一オブザーバで集中管理する方式に変更。長い会話でもメモリ消費とパフォーマンスが大幅に向上。

### リファクタリング
* **クラス責務の整理**: CSS生成処理を`ThemeManager`から`StyleGenerator`へ分離。
* **定数の集約**: 各種設定値を`CONSTANTS`オブジェクトで一元管理。
* **重複コードの整理**: ID生成や完了判定などを共通関数化し、DRY・可読性を改善。


## [1.2.2] - 2025-07-02

### 修正
- JSONインポート時に正しく正規表現チェックされていなかったのを修正。

## [1.2.1] - 2025-07-02

### 修正
- 2025-07-01のChatGPTのUI変更で追加された、画面下部のグラデーションを削除するCSSを追加。これにより、カスタム背景がグラデーションで隠される問題を修正しました。

### 改善
- チャット履歴の表示や、別チャットへの遷移時におけるテーマ適用の安定性を向上させました。ページ読み込み時に存在する全ての会話ターンをスキャンする処理を追加し、テーマの適用漏れが起こりにくくなりました。具体的には、カスタムGPTでアシスタントの最初のメッセージにテーマ適用されない問題が改善されています。

### リファクタリング
- メッセージバブルへのテーマ適用方法をリファクタリング。カスタムクラス（`.cpta-user-bubble`など）の付与を廃止し、よりシンプルで信頼性の高いCSSセレクタ方式に変更しました。これにより、DOM操作が減り、他のスクリプトとの競合リスクが低下しました。

## [1.2.0] - 2025-07-01

### 新機能（全てデフォルトON・設定で制御可）
- **GUIによる設定管理**
  - 設定パネルとテーマエディタを全面的に刷新し、JSONを直接編集することなく、ほとんどの設定をGUIで直感的に行えるようにしました。
- **メッセージ折りたたみ**
  - 長文のメッセージを自動で折りたたみ、必要に応じて展開できるようにしました。設定 (`features.collapsible_button`) で閾値やON/OFFの調整が可能です。
- **メッセージナビゲーション**
  - ユーザー／アシスタントごとに「前へ」「次へ」「メッセージの先頭に戻る」ボタンを追加しました。（`features.sequential_nav_buttons`、`features.scroll_to_top_button` で制御）
- **チャット表示幅カスタマイズ**
  - `options.chat_content_max_width` でチャットエリアの最大幅をユーザーが任意に設定できるようになりました。立ち絵やサイドバーの有無を動的に考慮して調整されます。

### 改善
- **テーブル表示改善**
  - 横に長いテーブルがチャットバブルからはみ出す問題を修正し、バブル内で水平スクロールできるようにしました。

### 破壊的変更 (Breaking Changes)
- **設定JSONの構造変更**
  - 設定を管理するJSONの構造を全面的に見直しました。これにより、**v1.1.1以前のバージョンとの互換性がなくなりました。**
  - **移行には[設定ファイル変換ツール](https://p65536.github.io/ChatGPT-Project-Theme-Automator/tools/convert_json.html)をご利用ください。**
  - 主な変更点：プロパティ名のcamelCase化、`projects`が`metadata.matchPatterns`に変更、など。

### リファクタリング
- **アーキテクチャ刷新**
  - 機能ごとに責務を分割したモダンなクラス設計とし、保守性・拡張性が大幅に向上しました。
- **CSSセレクタの堅牢化**
  - スクリプトが独自クラス名（例: `cpta-user-bubble`）を付与する方式に変更し、ChatGPT側のUI変更への耐性を高めました。
- **DOM監視の最適化**
  - 各会話ターン単位で監視を行い、依存機能（折りたたみ等）の実行タイミングを最適化・安定化させました。
- **設定の自動補完**
  - デフォルト設定との再帰的マージにより、古い/部分的な設定ファイルでも安全に動作するようにしました。
- **デバッグ機能の強化**
  - `cptaCheckSelectors()` で全セレクタの有効性を一括チェック可能にしました。

## [1.1.1] - 2025-06-21
- (修正) バブル幅や入力欄の背景色・文字色などで、設定値がnullの場合に意図せず透明になる不具合を修正。設定未指定時はChatGPTのデフォルトデザインが適用されるように変更。
- (仕様変更) バブル幅、バブル背景色、入力欄の各プロパティについて、値がnullまたは未設定の場合はCSS自体を出力しない方式に統一。

## [1.1.0] - 2025-06-21
- (変更) パフォーマンスと保守性向上のため、アバターの挿入ロジックを大幅にリファクタリング。
- (変更) 立ち絵を従来の`<img>`タグによる描画から、`<div>`要素の`background-image`プロパティを用いる方式に変更。
- (変更) `defaultSet`で`bubblePadding`,`bubbleBorderRadius`を指定。
- (機能追加) 立ち絵の実装変更に伴い、`standingImage`プロパティで従来の画像URLに加え`linear-gradient()`などのCSS関数をサポート。これにより、グラデーションなども表示可能。

## [1.0.4] - 2025-06-10
- スクリプトのアイコンにChatGPTのアイコンを設定
- ChatGPTのUI変更に伴い、サイドバーの幅取得のセレクタを変更

## [1.0.3] - 2025-06-01
- 開発版では正規表現のフラグに "i" を自動付与していたが、リリース時に削除したつもりのコードが残っていたため、今回完全に削除した。

## [1.0.2] - 2025-05-31
- 立ち絵のz-index調整(autoで様子見。他のscriptとの表示上の競合を考慮したもの)

## [1.0.1] - 2025-05-30
- 不適切なサンプル（コード埋め込み）を修正

## [1.0.0] - 2025-05-28
- 一般公開