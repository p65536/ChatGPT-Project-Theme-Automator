# ChatGPT Project Theme Automator 仕様書

---

## 1. 概要

本スクリプトはChatGPT（chatgpt.com）上で「プロジェクト（チャットルーム）やカスタムGPTごとに異なるテーマ（ユーザー名、アシスタント名、アイコン、文字色など）を自動適用する」Tampermonkeyユーザースクリプト。
プロジェクト名だけでなく、ページタイトル（カスタムGPT名やチャット名）もテーマの判定対象となるため、CustomGPTの名称にもマッチ可能。

**主な用途：**

* プロジェクト単位で個別の配色・キャラクター名・アイコンを切り替えたい
* 複数プロジェクトやロールプレイ、研修用途などでユーザー・アシスタント表記を柔軟に切り替えたい
* Plusユーザーの「プロジェクト機能」を活用し、業務・趣味の両方でUIのカスタマイズを行いたい

---

## 2. 動作要件

* ChatGPT公式Web [https://chatgpt.com/](https://chatgpt.com/) で動作
* Tampermonkey（最新版推奨）
* ブラウザ：Chrome, Firefox, Edge等（最新バージョン推奨）

---

## 3. スクリプト構造とカスタマイズ項目

### 3.1. 設定部

スクリプト先頭付近に以下の設定オブジェクトがある：

```js
const CHATGPT_PROJECT_THEME_CONFIG = {
    themeSets: [ ... ],  // プロジェクトごとのテーマ配列
    defaultSet: { ... }  // プロジェクト未設定時（デフォルト）テーマ
};
```

#### 3.1.1. themeSets 配列

各要素は1プロジェクトのテーマを定義：

* `projects`:
  プロジェクト名（文字列 or 正規表現）。配列で複数指定可、混在可。
* `user`, `assistant`:

  * `name`: 表示名
  * `icon`: アイコン画像（URL, base64, SVG可）
  * `textcolor`: テキスト色（CSSカラーコード）

> **項目省略時は defaultSet の値が使われる**

#### 3.1.2. defaultSet オブジェクト

* プロジェクト名に該当しない場合やfreeユーザーの初期表示で使用される
* `user`, `assistant`について、プロジェクトの設定と同様に設定可

#### 3.1.3. ICON\_SIZE

```js
const ICON_SIZE = 64; // または 96, 128
```

* アイコンサイズ（ピクセル単位）
* おすすめは64、好みに応じて96や128も指定可

---

### 3.2. テーマの判定・切り替えロジック

+ * プロジェクト名取得時、a.truncate[href^="/g/"]が存在すればそこから取得し、存在しない場合はdocument.titleから取得します（カスタムGPT名もここで対応）。

  * まず完全一致で探索
  * 次に正規表現（RegExp）で探索
  * いずれも該当しなければdefaultSetを適用
* テーマの切り替えは以下のタイミングで実行

  * ページ遷移（SPA対応：pushState/replaceState/href監視）
  * プロジェクト名要素（aタグ）のtextContent変化
  * チャットエリア（div > article）の生成/変更

---

### 3.3. アイコン・表示名の注入

* チャットメッセージ要素（`[data-message-author-role]`）ごとに

  * サイドにアイコン＋表示名を注入（ユーザー／アシスタント判定）
  * SVGやimg要素、textを配置
  * レイアウトCSSは初回のみ動的にstyle挿入

---

### 3.4. テキスト色の変更

* user/assistantそれぞれの色指定（textcolor）に従い、

  * Markdown要素群（p, h1～h6, ul, ol, li, strong, em, blockquote, table, th, td等）にのみ適用
  * コードブロックや数式（pre, code, katexなど）には**適用しない**
* 入力欄や固定UIには影響しないよう明示的にinherit指定

---

### 3.5. 監視・再適用ロジック

* MutationObserverで

  * メッセージエリア・プロジェクト名・チャット全体を監視
  * 新規チャット開始、履歴移動、動的生成時にも自動反映

---

## 4. サンプル設定

```js
const CHATGPT_PROJECT_THEME_CONFIG = {
    themeSets: [
        {
            projects: ['project1'],
            user: {},
            assistant: { textcolor: '#FF9900' }
        },
        {
            projects: ['project2'],
            user: {
                name: 'User',
                icon: '<svg ...>',
                textcolor: '#f0e68c'
            },
            assistant: {
                name: 'CPU',
                icon: '<svg ...>'
            }
        }
    ],
    defaultSet: {
        user: {
            name: 'You',
            icon: '<svg ...>'
        },
        assistant: {
            name: 'ChatGPT',
            icon: '<svg ...>'
        }
    }
};
```

* 必要な項目だけ指定し、省略分はdefaultSetで補完

---

## 5. 注意事項・制限事項

* **自動アップデートは非対応**：スクリプト更新時は必ず自分のテーマ設定を退避
* **テーマ外部保存は非対応**：設定内容はスクリプト直書き
* **ChatGPT UIの大規模アップデート時は再対応が必要となる場合あり**
* **SVG/base64埋め込みアイコン利用時はデータ量や描画コストに注意**
* **モバイルデバイスでの利用は考慮していない**

---

## 6. 推奨運用・カスタマイズ例

* アイコンや名前を設定することで自分専用アシスタント感倍増
* プロジェクトごとに文字色やアイコンが変わることで、現在何をしているか視覚的に分かりやすくなる
* 複数業務プロジェクト・TRPGセッションごとにキャラクター設定
* 自作アイコンやGoogle FontsのSVG利用による個性演出
* フォント・配色テーマもCSS追加で柔軟拡張可能
* カスタムGPTの名称でテーマを適用したい場合、正規表現でタイトルパターンを指定することで柔軟にマッチできる

---

## 7. 拡張案（ただし個人的には必要性が低いと感じているため、自分では実装しないと思う）

* 設定ファイル外部化・UIによる簡易カスタマイズ
* チャットバブル背景色変更
* チャット入力欄へのテーマ適用
* ライト／ダークテーマに応じた配色（自分はダークのみ使用）
* テーマごとの詳細カスタマイズ（バッジ表示、装飾追加、CSS上書き等）
* 多言語表示対応、プロジェクト自動判別の強化

---

## 8. ライセンス・作者情報

* MIT License
* 作者: [p65536](https://github.com/p65536)

---
